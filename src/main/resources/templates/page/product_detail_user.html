<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chi tiết sản phẩm</title>
    <link href="/css/product_detail.css" rel="stylesheet">
    <link href="/css/Home.css" rel="stylesheet">
</head>
<body>
<nav th:replace="~{/header/NavbarProducts}"></nav>

<div class="product-detail">
    <!-- Cột ảnh -->
    <div class="product-image">
        <img th:src="@{${product.thumbnail}}" alt="Ảnh sản phẩm" width="300" height="300"/>
    </div>

    <!-- Cột thông tin -->
    <div class="product-info">
        <h1 th:text="${product.productName}">Tên sản phẩm</h1>

        <!-- Giá -->
        <div>
            <strong>Giá:</strong>
            <div th:if="${isDiscount}">
                <span style="color: black; font-weight: bold; margin-left: 10px;"
                      th:text="${formattedFinalPrice}"></span>
                <span style="color: green; margin-left: 10px;"
                      th:if="${discountPercent > 0}"
                      th:text="'(Giảm ' + ${discountPercent} + '%)'"></span>
                <span style="text-decoration: line-through; color: gray;"
                      th:text="${formattedPrice}"></span>
            </div>
            <div th:unless="${isDiscount}">
                <span style="font-weight: bold;" th:text="${formattedPrice}"></span>
            </div>
        </div>

        <hr>

        <!-- Màu sắc -->
        <div th:if="${colors != null}">
            <strong>Màu sắc:</strong>
            <div style="margin: 5px 0;">
                <button type="button" th:each="color : ${colors}"
                        th:text="${color}" class="color-btn"
                        onclick="selectColor(this)">
                </button>
            </div>
        </div>

        <hr>

        <!-- Kích thước -->
        <div th:if="${sizes != null}">
            <strong>Kích thước:</strong>
            <div style="margin: 5px 0;">
                <button type="button" th:each="size : ${sizes}"
                        th:text="${size}" class="size-btn"
                        onclick="selectSize(this)">
                </button>
            </div>
        </div>

        <hr>

        <!-- Mô tả -->
        <p>
            <strong>Thông tin chi tiết sản phẩm:</strong>
            <span th:text="${product.description}">Mô tả sản phẩm</span>
        </p>

        <!-- Form thêm vào giỏ -->
        <form th:action="@{/cart/add}" method="post" id="addToCartForm">
            <input type="hidden" name="productDetailId" id="productDetailId">
            <input type="number" name="quantity" value="1" min="1">
            <div class="product-actions">
                <button type="submit">Thêm vào giỏ hàng</button>
                <button type="button">Mua ngay</button>
            </div>
        </form>
    </div>
</div>

<script th:inline="javascript">
    let selectedColor = null;
    let selectedSize = null;
    const productDetails = /*[[${productDetailsList}]]*/ [];

    function selectColor(btn) {
        selectedColor = btn.textContent;
        document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        updateProductDetailId();
    }

    function selectSize(btn) {
        selectedSize = btn.textContent;
        document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        updateProductDetailId();
    }

    function updateProductDetailId() {
        if (selectedColor && selectedSize) {
            const match = productDetails.find(pd =>
                pd.color.colorName === selectedColor &&
                pd.size.size === selectedSize
            );
            if (match) {
                document.getElementById('productDetailId').value = match.id;
            }
        }
    }
</script>

</body>
</html>
